name: CI/CD Pipeline

on: [push]

jobs:
  unit-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run Unit Tests
        run: |
          # –¢–µ—Å—Ç–∏—Ä—É–µ–º –ö–ê–ñ–î–´–ô —Å–µ—Ä–≤–∏—Å –æ—Ç–¥–µ–ª—å–Ω–æ
          echo hello
          for service in payment-service order-service payment-gateway report-service; do
            if [ -d "$service" ]; then
              echo "üîç Testing $service..."
              cd $service
              mvn test
              cd ..
            fi
          done

  integration-tests:
    needs: unit-tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run Integration Tests
        run: |
          # –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–µ–∂–¥—É 2-3 —Å–µ—Ä–≤–∏—Å–∞–º–∏
          echo "Testing payment + order integration..."
          # –ó–¥–µ—Å—å —Ç–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç API –≤—ã–∑–æ–≤—ã –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏

  e2e-tests:
    needs: integration-tests  
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run E2E Tests
        run: |
          # –¢–µ—Å—Ç–∏—Ä—É–µ–º –í–°–Æ —Å–∏—Å—Ç–µ–º—É
          docker-compose up -d
          sleep 30
          # –¢–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—Ö–æ–¥—è—Ç –ø–æ–ª–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:
          # –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ ‚Üí –û–ø–ª–∞—Ç–∞ ‚Üí –ü–æ–ª—É—á–µ–Ω–∏–µ —á–µ–∫–∞